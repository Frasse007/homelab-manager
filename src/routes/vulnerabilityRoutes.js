const express = require('express');
const router = express.Router();
const vulnerabilityController = require('../controllers/vulnerabilityController.js');
const { authenticate } = require('../middleware/auth.js');
const validate = require('../middleware/validate.js');
const { createVulnerabilityValidator, updateVulnerabilityValidator } = require('../validators/vulnerabilityValidator.js');

// All vulnerability routes require authentication
router.use(authenticate);

// Vulnerabilities statistics route
router.get('/stats', vulnerabilityController.getVulnerabilityStats);

// CRUD routes
// GET /api/vulnerabilities - Gets all vulnerabilities
router.get('/', vulnerabilityController.getAllVulnerabilities);

// GET /api/vulnerabilities/:id - Gets single vulnerability by its ID
router.get('/:id', vulnerabilityController.getVulnerabilityById);

// POST /api/vulnerabilities - Creates new vulnerability
router.post('/', createVulnerabilityValidator, validate, vulnerabilityController.createVulnerability);

// PUT /api/vulnerabilities/:id - Updates information for a vulnerability by its ID
router.put('/:id', updateVulnerabilityValidator, validate, vulnerabilityController.updateVulnerability);

// DELETE /api/vulnerabilities/:id - Deletes a vulnerability by its ID
router.delete('/:id', vulnerabilityController.deleteVulnerability);

module.exports = router;