const { body } = require('express-validator');

// Validaton logic for creating vulnerabilities
const createVulnerabilityValidator = [
  body('service_id')
    .isInt()
    .withMessage('Service ID must be an integer'),
  
  body('cve_id')
    .optional()
    .trim()
    .matches(/^CVE-\d{4}-\d{4,7}$/i)
    .withMessage('Please provide a valid CVE ID (e.g., CVE-2026-1234)'),
  
  body('title')
    .trim()
    .notEmpty()
    .withMessage('Title is required')
    .isLength({ max: 255 })
    .withMessage('Title must not exceed 255 characters'),
  
  body('description')
    .trim()
    .notEmpty()
    .withMessage('Description is required'),
  
  body('severity')
    .notEmpty()
    .withMessage('Severity is required')
    .isIn(['Critical', 'High', 'Medium', 'Low', 'Informational'])
    .withMessage('Invalid severity level'),
  
  body('cvss_score')
    .optional()
    .isFloat({ min: 0.0, max: 10.0 })
    .withMessage('CVSS score must be between 0.0 and 10.0'),
  
  body('discovered_date')
    .optional()
    .isISO8601()
    .withMessage('Please provide a valid date'),
  
  body('status')
    .optional()
    .isIn(['open', 'in_progress', 'patched', 'mitigated', 'accepted'])
    .withMessage('Invalid status'),
  
  body('patched_date')
    .optional()
    .isISO8601()
    .withMessage('Please provide a valid date'),
  
  body('remediation_notes')
    .optional()
    .trim()
];

// Validation logic for updating vulnerabilities
const updateVulnerabilityValidator = [
  body('cve_id')
    .optional()
    .matches(/^CVE-\d{4}-\d{4,7}$/i)
    .withMessage('Please provide a valid CVE ID (e.g., CVE-2026-1234)'),
  
  body('title')
    .optional()
    .trim()
    .notEmpty()
    .withMessage('Title cannot be empty')
    .isLength({ max: 255 })
    .withMessage('Title must not exceed 255 characters'),
  
  body('description')
    .optional()
    .trim()
    .notEmpty()
    .withMessage('Description cannot be empty'),
  
  body('severity')
    .optional()
    .isIn(['Critical', 'High', 'Medium', 'Low', 'Informational'])
    .withMessage('Invalid severity level'),
  
  body('cvss_score')
    .optional()
    .isFloat({ min: 0.0, max: 10.0 })
    .withMessage('CVSS score must be between 0.0 and 10.0'),
  
  body('status')
    .optional()
    .isIn(['open', 'in_progress', 'patched', 'mitigated', 'accepted'])
    .withMessage('Invalid status'),
  
  body('patched_date')
    .optional()
    .isISO8601()
    .withMessage('Please provide a valid date')
];

module.exports = {
  createVulnerabilityValidator,
  updateVulnerabilityValidator
};